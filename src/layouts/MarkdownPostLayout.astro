---
import Layout from "./Layout.astro";
import { seoConfig, getOgImageUrl, getAbsoluteUrl } from "@/lib/seo/config";

const { frontmatter, id } = Astro.props;

const postUrl = getAbsoluteUrl(`/posts/${id}`);
const postImage = frontmatter.image?.url?.src || getOgImageUrl();

const blogPostSchema = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  headline: frontmatter.title,
  description: frontmatter.description,
  image: postImage,
  author: {
    "@type": "Person",
    name: frontmatter.author || seoConfig.siteName,
  },
  datePublished: frontmatter.pubDate,
  mainEntityOfPage: {
    "@type": "WebPage",
    "@id": postUrl,
  },
  publisher: {
    "@type": "Organization",
    name: seoConfig.siteName,
    logo: {
      "@type": "ImageObject",
      url: getOgImageUrl(),
    },
  },
  articleBody: frontmatter.description,
  keywords: frontmatter.tags ? frontmatter.tags.join(", ") : "",
};

const metaTags = {
  title: `${frontmatter.title} | ${seoConfig.siteName}`,
  description: frontmatter.description,
  image: postImage,
  url: postUrl,
  schemaData: [blogPostSchema],
};
---

<Layout metaTags={metaTags}>
  <div class="mx-auto max-w-3xl px-4 py-8 sm:px-6 sm:py-12 lg:py-16">
    <p class="text-xs text-stone-500 sm:text-sm">
      {frontmatter.pubDate.toString().slice(0, 10)}
    </p>
    <h1 class="mb-4 mt-2 text-2xl font-bold leading-tight text-stone-900 sm:text-3xl lg:text-4xl">
      {frontmatter.title}
    </h1>
    <p class="mb-4 text-base italic leading-relaxed text-stone-600 sm:text-lg">
      {frontmatter.description}
    </p>
    <p class="mb-6 text-sm font-medium text-stone-700">
      Written by: <span class="text-teal-600">{frontmatter.author}</span>
    </p>
    {frontmatter.image?.url?.src && (
      <img
        class="mb-8 h-auto w-full rounded-xl shadow-lg"
        src={frontmatter.image.url.src}
        alt={frontmatter.image.alt || frontmatter.title}
      />
    )}
    {
      frontmatter.tags && frontmatter.tags.length > 0 && (
        <div class="mb-6 flex flex-wrap gap-2">
          {frontmatter.tags.map((tag) => (
            <span class="rounded-full bg-stone-700 px-3 py-1.5 text-xs font-semibold text-stone-100 sm:text-sm">
              {tag}
            </span>
          ))}
        </div>
      )
    }
    <article
      class="prose prose-stone prose-sm sm:prose-base lg:prose-lg prose-headings:font-semibold prose-p:leading-relaxed"
    >
      <slot />
    </article>
  </div>
</Layout>
