---
export const prerender = false;
import Layout from "../layouts/Layout.astro";
import CalendarApp from "@/components/Calendar";
import { getEvents } from "../lib/wordpress/fetchEvents";
import Hero from "@/components/CalendarHero";
import { generateEventSchemas } from "@/lib/seo/schemas";
import { processAndSortEvents, type ProcessedEvent } from "../lib/events";
import { config } from "../lib/config";

let events: ProcessedEvent[] = [];

try {
  const fetchedEvents = await getEvents();
  events = processAndSortEvents(fetchedEvents);
} catch (error) {
  console.error("Failed to fetch or process events:", error);
  events = [];
}

const eventSchemas = generateEventSchemas(events);
const showClosureAnnouncement = config.showClosureAnnouncement;

const metaTags = {
  title: "Live Music & Events Calendar | Tolbert's Restaurant Grapevine",
  description:
    "Check out upcoming live music events at Tolbert's Restaurant & Chili Parlor in Grapevine, TX. Enjoy great food, drinks, and entertainment in historic downtown.",
  url: "https://tolbertsrestaurant.com/calendar",
  schemaData: eventSchemas,
};
---

<Layout metaTags={metaTags}>
  <main class="bg-repeat md:mt-0">
    {showClosureAnnouncement && (
      <!-- Closure Notice Banner -->
      <div class="bg-red-600 px-4 py-3 text-white">
        <div class="mx-auto max-w-7xl text-center">
          <p class="text-lg font-semibold">
            ðŸš¨ RESTAURANT CLOSED TO PUBLIC - Thursday, October 9th
          </p>
          <p class="text-sm">
            Closing early at 2:30 PM for private sold-out event. Reopening Friday
            for regular hours.
          </p>
        </div>
      </div>
    )}

    <div class="hidden lg:block">
      <Hero events={events} client:load />
    </div>
    <div class="mx-auto max-w-7xl pb-8 sm:pb-12 lg:pb-16">
      {
        events.length > 0 ? (
          <CalendarApp events={events} client:load />
        ) : (
          <div class="flex min-h-[50vh] items-center justify-center px-4 py-12">
            <div class="max-w-2xl text-center">
              <h2 class="text-2xl font-bold md:text-3xl">
                Hold onto your hats!
              </h2>
              <p class="mt-4 text-base leading-relaxed sm:text-lg md:text-xl">
                I bet you're excited to hear some live music! We're reorganizing
                our calendar to give you the best experience. Please check back
                soon.
              </p>
            </div>
          </div>
        )
      }
    </div>
  </main>
</Layout>
